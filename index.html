<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ÛŒØ² Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ú†Ù…Ø±Ø§Ù†</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />
    <style>
        :root { --primary: #1a237e; --accent: #ff6f00; --bg: #f5f5f5; }
        body { font-family: 'Vazirmatn', sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .card { background: white; width: 92%; max-width: 700px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); margin: 20px 0; text-align: center; }
        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .video-item { 
            background: #fff; border: 2px solid #eee; border-radius: 15px; 
            margin-bottom: 10px; padding: 15px; display: flex; align-items: center; 
            gap: 15px; cursor: pointer; transition: 0.3s; text-align: right;
        }
        .video-item:hover { border-color: var(--accent); background: #fff8f1; }
        .video-icon { font-size: 2rem; }
        .video-info h4 { margin: 0; color: var(--primary); }

        input { width: 80%; padding: 15px; margin: 20px 0; border: 2px solid #ddd; border-radius: 50px; text-align: center; font-family: inherit; font-size: 1rem; }
        .btn-main { background: var(--primary); color: white; border: none; padding: 15px 40px; border-radius: 50px; cursor: pointer; width: 100%; font-family: inherit; font-size: 1.1rem; }
        video { width: 100%; border-radius: 15px; background: #000; margin-top: 15px; }
        .alert-box { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #d32f2f; color: white; padding: 10px 20px; border-radius: 10px; z-index: 1000; display: none; }
        .badge { background: var(--accent); color: white; padding: 3px 10px; border-radius: 5px; font-size: 0.8rem; }
    </style>
</head>
<body>

    <div id="cheatAlert" class="alert-box">âš ï¸ Ø¬Ù„Ùˆ Ø²Ø¯Ù† ÙÛŒÙ„Ù… Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª!</div>

    <div id="screen-login" class="card screen active">
        <div style="font-size: 4rem;">ğŸ«</div>
        <h2>Ù…ÛŒØ² Ù…Ø·Ø§Ù„Ø¹Ù‡ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ú†Ù…Ø±Ø§Ù†</h2>
        <p>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</p>
        <input type="text" id="inpName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
        <button class="btn-main" onclick="login()">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ù„Ø§Ø³</button>
    </div>

    <div id="screen-library" class="card screen">
        <h3 style="text-align: right;">ğŸ“š Ù„ÛŒØ³Øª ÙÛŒÙ„Ù…â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ:</h3>
        <div id="video-list">
            
            <div class="video-item" onclick="selectVideo('Ø±ÛŒØ§Ø¶ÛŒ Ú©Ø§Ø±Ø¨Ø±Ú¯ Ù‡ÙØªÙ‡ Ûµ', 'kargarb-w5.mp4')">
                <div class="video-icon">ğŸ¬</div>
                <div class="video-info">
                    <h4>Ø±ÛŒØ§Ø¶ÛŒ Ú©Ø§Ø±Ø¨Ø±Ú¯ Ù‡ÙØªÙ‡ Ûµ</h4>
                    <span class="badge">Ø¬Ø¯ÛŒØ¯</span>
                </div>
            </div>

            </div>
    </div>

    <div id="screen-player" class="card screen">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <button onclick="switchScreen('screen-library')" style="width: auto; padding: 5px 15px; background: #666; color:white; border:none; border-radius:10px; cursor:pointer;">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
            <strong id="currentVideoTitle">Ø¹Ù†ÙˆØ§Ù† ÙÛŒÙ„Ù…</strong>
        </div>
        <video id="myVideo" controls controlsList="nodownload"></video>
        <div id="viewStatus" style="margin-top:10px; font-weight:bold; color:var(--accent);">Û°Ùª Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø´Ø¯Ù‡</div>
    </div>

    <script>
        // *** ØªÙ†Ø¸ÛŒÙ…Ø§Øª ***
        const TEACHER_EMAIL = "YOUR_EMAIL_HERE"; // Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯
        const DB_PREFIX = "chamran_lib_v2_";

        let studentName = "";
        let currentVideoFile = "";
        let currentVideoTitle = "";
        let maxTimeWatched = 0;
        let videoDuration = 0;
        let isFinished = false;

        const vid = document.getElementById('myVideo');

        function login() {
            const name = document.getElementById('inpName').value.trim();
            if(name.length < 3) return alert("Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ú©Ø§Ù…Ù„ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");
            studentName = name;
            switchScreen('screen-library');
        }

        function selectVideo(title, file) {
            currentVideoTitle = title;
            currentVideoFile = file;
            document.getElementById('currentVideoTitle').innerText = title;
            vid.src = file;
            isFinished = false;
            
            const saved = localStorage.getItem(DB_PREFIX + studentName + "_" + file);
            maxTimeWatched = saved ? parseFloat(saved) : 0;
            
            switchScreen('screen-player');
            if(maxTimeWatched > 2) {
                if(confirm("Ù…Ø§ÛŒÙ„ÛŒØ¯ ÙÛŒÙ„Ù… Ø±Ø§ Ø§Ø² Ø§Ø¯Ø§Ù…Ù‡ Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ø¯ÛŒØ¯ÛŒØ¯ ØªÙ…Ø§Ø´Ø§ Ú©Ù†ÛŒØ¯ØŸ")) vid.currentTime = maxTimeWatched;
            }
            vid.play();
        }

        function switchScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id !== 'screen-player') vid.pause();
        }

        vid.onloadedmetadata = () => videoDuration = vid.duration;

        vid.addEventListener('seeking', function() {
            if (vid.currentTime > maxTimeWatched + 2) {
                vid.currentTime = maxTimeWatched;
                document.getElementById('cheatAlert').style.display = 'block';
                setTimeout(() => document.getElementById('cheatAlert').style.display = 'none', 3000);
            }
        });

        vid.addEventListener('timeupdate', function() {
            if (!vid.seeking && vid.currentTime > maxTimeWatched) {
                maxTimeWatched = vid.currentTime;
                localStorage.setItem(DB_PREFIX + studentName + "_" + currentVideoFile, maxTimeWatched);
            }
            if(videoDuration > 0) {
                const percent = Math.round((maxTimeWatched / videoDuration) * 100);
                document.getElementById('viewStatus').innerText = percent + "Ùª Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø´Ø¯Ù‡";
            }
        });

        vid.addEventListener('ended', function() {
            if(!isFinished) {
                isFinished = true;
                sendReport("ØªÚ©Ù…ÛŒÙ„ Û±Û°Û°Ùª ÙˆÛŒØ¯ÛŒÙˆ", 100);
                alert("Ø¢ÙØ±ÛŒÙ†! Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø§ÛŒÙ† Ø¯Ø±Ø³ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯.");
            }
        });

        function sendReport(status, percent) {
            if(TEACHER_EMAIL === "YOUR_EMAIL_HERE") return;
            fetch(`https://formsubmit.co/ajax/${TEACHER_EMAIL}`, {
                method: "POST",
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²: studentName,
                    Ù†Ø§Ù…_Ø¯Ø±Ø³: currentVideoTitle,
                    ÙˆØ¶Ø¹ÛŒØª: status,
                    Ø¯Ø±ØµØ¯_Ù…Ø´Ø§Ù‡Ø¯Ù‡: percent + "%"
                })
            });
        }
    </script>
</body>
</html>