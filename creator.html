<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù¾Ù†Ù„ Ø³Ø§Ø®Øª Ù…Ø­ØªÙˆØ§ (Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ùˆ Ø§Ù…Ù†)</title>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background: #ecf0f1; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 800px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); margin-bottom: 30px; border-top: 5px solid var(--border-color, #ccc); }
        
        /* Ø¨Ø§Ú©Ø³ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª */
        .auth-box { 
            background: #2c3e50; padding: 20px; border-radius: 15px; width: 100%; max-width: 800px; 
            margin-bottom: 25px; color: white; display: flex; flex-direction: column; align-items: center; gap: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2); 
        }
        .auth-box input { margin: 0; width: 50%; text-align: center; border: 3px solid #e67e22; background: white; color: black; font-weight: bold; font-size: 1.1rem; }
        
        h2 { text-align: center; color: #2c3e50; margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 15px; }
        label { font-weight: bold; color: #34495e; display: block; margin-top: 15px; margin-bottom: 5px; }
        
        input, textarea, select { width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 10px; box-sizing: border-box; font-family: inherit; font-size: 1rem; transition: 0.3s; }
        input:focus, textarea:focus { border-color: #3498db; outline: none; }
        
        /* Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ø§ÙÙ‚ÛŒ */
        .row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        
        button { padding: 12px 20px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        button:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .btn-green { background: #27ae60; color: white; width: 100%; margin-top: 20px; }
        .btn-blue { background: #2980b9; color: white; width: 100%; margin-top: 20px; }
        .btn-small { padding: 8px 15px; font-size: 0.9rem; }
        .btn-add { background: #f39c12; color: white; margin-bottom: 10px; }
        .btn-del { background: #e74c3c; color: white; width: auto; padding: 10px 15px; }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¨Ø§Ú©Ø³ Ø³ÙˆØ§Ù„ */
        .q-box { background: #f8f9fa; border: 2px solid #e1e8ed; border-radius: 15px; padding: 20px; margin-bottom: 20px; position: relative; }
        .q-num { background: #34495e; color: white; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; position: absolute; left: 15px; top: 15px; }
        .del-q { position: absolute; left: 15px; top: 50px; color: #e74c3c; cursor: pointer; font-size: 0.9rem; border: 1px solid #e74c3c; padding: 4px 10px; border-radius: 5px; background: #fff; }
        
        .opt-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; background: white; padding: 8px; border-radius: 8px; border: 1px solid #eee; }
        .opt-label { width: 80px; font-size: 0.9rem; color: #7f8c8d; }
    </style>
</head>
<body>

    <div class="auth-box">
        <span style="font-size: 1.2rem;">ğŸ”’ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù…Ø¯ÛŒØ±</span>
        <input type="password" id="admin_token" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ù…Ù†ÛŒØªÛŒ (Admin Token)">
        <small style="color: #bdc3c7;">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù‡Ù…Ø§Ù† Ø§Ø³Øª Ú©Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„ index.js Ø³Ø±ÙˆØ± Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯ÛŒØ¯.</small>
    </div>

    <div class="container" style="--border-color: #27ae60;">
        <h2>ğŸ¬ Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯</h2>
        
        <label>Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³:</label>
        <input id="l_title" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø±ÛŒØ§Ø¶ÛŒ ÙØµÙ„ Û´">
        
        <label>Ù„ÛŒÙ†Ú© ÙÛŒÙ„Ù… Ø§ØµÙ„ÛŒ (MP4):</label>
        <input id="l_link" dir="ltr" placeholder="https://site.com/video.mp4">
        
        <label>ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ù…ÛŒÙ…Ù‡ (PDFØŒ ØªÙ…Ø±ÛŒÙ† Ùˆ...):</label>
        <div id="attach_container"></div>
        <button type="button" class="btn-add btn-small" onclick="addAttachRow()">â• Ø§ÙØ²ÙˆØ¯Ù† ÙØ§ÛŒÙ„ Ø¶Ù…ÛŒÙ…Ù‡</button>
        
        <button class="btn-green" onclick="saveLesson()">ğŸ’¾ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø³ Ø¨Ù‡ Ø³Ø±ÙˆØ±</button>
    </div>

    <div class="container" style="--border-color: #2980b9;">
        <h2>ğŸ“ Ø³Ø§Ø®Øª Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø¯ÛŒØ¯ (Ù¾ÛŒØ´Ø±ÙØªÙ‡)</h2>
        
        <div class="row">
            <div style="flex:2"><label>Ù†Ø§Ù… Ø¢Ø²Ù…ÙˆÙ†:</label><input id="e_title" placeholder="Ø¢Ø²Ù…ÙˆÙ† Ø¹Ù„ÙˆÙ…"></div>
            <div style="flex:1"><label>Ø²Ù…Ø§Ù† (Ø¯Ù‚ÛŒÙ‚Ù‡):</label><input type="number" id="e_time" value="15"></div>
            <div style="flex:1"><label>Ø±Ù…Ø² (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label><input id="e_pass"></div>
        </div>
        
        <div id="questions_area"></div>
        
        <button onclick="addQuestion()" class="btn-add" style="width:100%">â• Ø§ÙØ²ÙˆØ¯Ù† Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯</button>
        <button class="btn-blue" onclick="saveExam()">ğŸ’¾ Ø§Ø±Ø³Ø§Ù„ Ø¢Ø²Ù…ÙˆÙ† Ø¨Ù‡ Ø³Ø±ÙˆØ±</button>
    </div>

    <script>
        // ***********************************************
        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        // ***********************************************
        const API_URL = "https://chamran-api.liara.run"; // Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ±

        // ØªØ§Ø¨Ø¹ Ø¯Ø±ÛŒØ§ÙØª Ùˆ Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆÚ©Ù†
        function getAuth() {
            const token = document.getElementById('admin_token').value.trim();
            if(!token) { 
                alert("â›” Ø®Ø·Ø§: Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù…Ø¯ÛŒØ±ÛŒØª Ø±Ø§ Ø¯Ø± Ú©Ø§Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ØµÙØ­Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."); 
                document.getElementById('admin_token').focus();
                return null; 
            }
            return token;
        }

        // --- Ù…Ø¯ÛŒØ±ÛŒØª Ø¶Ù…ÛŒÙ…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø±Ø³ ---
        function addAttachRow() {
            const div = document.createElement('div');
            div.className = 'row';
            div.innerHTML = `
                <input class="att-name" placeholder="Ù†Ø§Ù… ÙØ§ÛŒÙ„ (Ù…Ø«Ù„Ø§: Ø¬Ø²ÙˆÙ‡)" style="flex:1">
                <input class="att-link" placeholder="Ù„ÛŒÙ†Ú© Ø¯Ø§Ù†Ù„ÙˆØ¯" dir="ltr" style="flex:2">
                <button class="btn-del" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
            `;
            document.getElementById('attach_container').appendChild(div);
        }

        async function saveLesson() {
            const token = getAuth();
            if(!token) return;

            const title = document.getElementById('l_title').value;
            const link = document.getElementById('l_link').value;
            
            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¶Ù…ÛŒÙ…Ù‡â€ŒÙ‡Ø§
            const attachRows = document.querySelectorAll('#attach_container .row');
            let attachList = [];
            attachRows.forEach(row => {
                const n = row.querySelector('.att-name').value.trim();
                const l = row.querySelector('.att-link').value.trim();
                if(n && l) attachList.push(`${n}|${l}`);
            });
            const attachStr = attachList.join(',');

            if(!title || !link) return alert("âŒ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ù„ÛŒÙ†Ú© ÙÛŒÙ„Ù… Ø§ØµÙ„ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª!");

            const btn = event.target;
            btn.innerText = "â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...";
            btn.disabled = true;
            
            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        action: 'save_lesson',
                        admin_token: token, // ğŸ”’ Ø§Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø¨Ù‡ Ø³Ø±ÙˆØ±
                        title: title,
                        link: link,
                        attach: attachStr
                    })
                });
                const data = await res.json();
                if(data.status === 'success') {
                    alert("âœ… Ø¯Ø±Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!");
                    location.reload(); 
                } else { alert("âŒ Ø®Ø·Ø§ Ø§Ø² Ø³Ø±ÙˆØ±: " + data.message); }
            } catch(e) { alert("âŒ Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±"); }
            
            btn.innerText = "ğŸ’¾ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø³ Ø¨Ù‡ Ø³Ø±ÙˆØ±";
            btn.disabled = false;
        }

        // --- Ù…Ø¯ÛŒØ±ÛŒØª Ø³ÙˆØ§Ù„Ø§Øª Ø¢Ø²Ù…ÙˆÙ† ---
        let qCount = 0;
        
        function addQuestion() {
            qCount++;
            const div = document.createElement('div');
            div.className = 'q-box';
            div.innerHTML = `
                <span class="q-num">Ø³ÙˆØ§Ù„ ${qCount}</span>
                <span class="del-q" onclick="removeQuestion(this)">Ø­Ø°Ù</span>
                
                <label>Ù…ØªÙ† Ø³ÙˆØ§Ù„:</label>
                <input class="q-txt" placeholder="ØµÙˆØ±Øª Ø³ÙˆØ§Ù„ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
                <input class="q-img" placeholder="Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ± Ø³ÙˆØ§Ù„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø§Ú¯Ø± Ù…ØªÙ† Ù†Ø¯Ø§Ø±ÛŒØ¯)" dir="ltr" style="margin-top:5px; font-size:0.9rem; border:1px dashed #bbb; background:#fafafa;">

                <label style="margin-top:15px;">Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ (Ù…ØªÙ† ÛŒØ§ Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ±):</label>
                ${[1, 2, 3, 4].map(i => `
                    <div class="opt-row">
                        <span class="opt-label">Ú¯Ø²ÛŒÙ†Ù‡ ${i}:</span>
                        <input class="op${i}" placeholder="Ù…ØªÙ† Ú¯Ø²ÛŒÙ†Ù‡ ÛŒØ§ Ù„ÛŒÙ†Ú© ØªØµÙˆÛŒØ±">
                    </div>
                `).join('')}

                <label>Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­:</label>
                <select class="correct-ans" style="background:#e8f8f5;">
                    <option value="1">Ú¯Ø²ÛŒÙ†Ù‡ Û±</option>
                    <option value="2">Ú¯Ø²ÛŒÙ†Ù‡ Û²</option>
                    <option value="3">Ú¯Ø²ÛŒÙ†Ù‡ Û³</option>
                    <option value="4">Ú¯Ø²ÛŒÙ†Ù‡ Û´</option>
                </select>
            `;
            document.getElementById('questions_area').appendChild(div);
        }

        function removeQuestion(btn) {
            if(confirm('Ø¢ÛŒØ§ Ø§ÛŒÙ† Ø³ÙˆØ§Ù„ Ø­Ø°Ù Ø´ÙˆØ¯ØŸ')) {
                btn.parentElement.remove();
            }
        }

        async function saveExam() {
            const token = getAuth();
            if(!token) return;

            const title = document.getElementById('e_title').value;
            const time = document.getElementById('e_time').value;
            const pass = document.getElementById('e_pass').value;
            
            const qElements = document.querySelectorAll('.q-box');
            if(!title || qElements.length === 0) return alert("âŒ Ø¹Ù†ÙˆØ§Ù† Ø¢Ø²Ù…ÙˆÙ† Ùˆ Ø­Ø¯Ø§Ù‚Ù„ ÛŒÚ© Ø³ÙˆØ§Ù„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª!");

            const questions = [];
            qElements.forEach(el => {
                questions.push({
                    q: el.querySelector('.q-txt').value,
                    img: el.querySelector('.q-img').value, // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ Ø³ÙˆØ§Ù„
                    options: [
                        el.querySelector('.op1').value,
                        el.querySelector('.op2').value,
                        el.querySelector('.op3').value,
                        el.querySelector('.op4').value
                    ],
                    correct: el.querySelector('.correct-ans').value
                });
            });

            const btn = event.target;
            btn.innerText = "â³ Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...";
            btn.disabled = true;

            try {
                const res = await fetch(API_URL, {
                    method: 'POST',
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        action: 'save_exam',
                        admin_token: token, // ğŸ”’ Ø§Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø¨Ù‡ Ø³Ø±ÙˆØ±
                        title: title,
                        time: time,
                        pass: pass,
                        questions: questions
                    })
                });
                const data = await res.json();
                if(data.status === 'success') {
                    alert("âœ… Ø¢Ø²Ù…ÙˆÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯!");
                    location.reload();
                } else { alert("âŒ Ø®Ø·Ø§ Ø§Ø² Ø³Ø±ÙˆØ±: " + data.message); }
            } catch(e) { alert("âŒ Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±"); }
            
            btn.innerText = "ğŸ’¾ Ø§Ø±Ø³Ø§Ù„ Ø¢Ø²Ù…ÙˆÙ† Ø¨Ù‡ Ø³Ø±ÙˆØ±";
            btn.disabled = false;
        }
        
        // Ø´Ø±ÙˆØ¹ Ø§ÙˆÙ„ÛŒÙ‡
        addQuestion();
        addAttachRow(); 
    </script>
</body>
</html>
